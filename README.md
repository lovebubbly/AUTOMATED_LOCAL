# ğŸ¬ AI Director Automation System (Local ComfyUI Edition)

> **Yunseong [404] Prism Director** - ComfyUI API ê¸°ë°˜ ë¡œì»¬ AI ì´ë¯¸ì§€/ë¹„ë””ì˜¤ ìƒì„± ìë™í™” ì‹œìŠ¤í…œ

[![Python](https://img.shields.io/badge/Python-3.8+-blue.svg)](https://www.python.org/)
[![ComfyUI](https://img.shields.io/badge/ComfyUI-Local_API-orange.svg)](https://github.com/comfyanonymous/ComfyUI)
[![FastAPI](https://img.shields.io/badge/FastAPI-Latest-teal.svg)](https://fastapi.tiangolo.com/)
[![Vue.js](https://img.shields.io/badge/Vue.js-3.x-brightgreen.svg)](https://vuejs.org/)

## ğŸ“‹ í”„ë¡œì íŠ¸ ê°œìš”

AI DirectorëŠ” **ComfyUI ë¡œì»¬ API**ë¥¼ í†µí•´ AI ì´ë¯¸ì§€ ìƒì„±ì„ ìë™í™”í•˜ëŠ” ì›Œí¬í”Œë¡œìš° ì‹œìŠ¤í…œì…ë‹ˆë‹¤. ê¸°ì¡´ Playwright ê¸°ë°˜ ì›¹ ìë™í™”ì—ì„œ **ì§ì ‘ ComfyUI HTTP/WebSocket API í˜¸ì¶œ**ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ë˜ì–´ ë” ë¹ ë¥´ê³  ì•ˆì •ì ì¸ ìƒì„±ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

### âœ¨ ì£¼ìš” íŠ¹ì§•

- **ë¡œì»¬ ì‹¤í–‰**: ì™¸ë¶€ ì„œë¹„ìŠ¤ ì˜ì¡´ì„± ì—†ì´ ë¡œì»¬ ComfyUI ì„œë²„ì™€ ì§ì ‘ í†µì‹ 
- **ì‹¤ì‹œê°„ ì§„í–‰ë¥ **: WebSocketì„ í†µí•œ ë…¸ë“œë³„ ì‹¤ì‹œê°„ ì§„í–‰ ìƒí™© ëª¨ë‹ˆí„°ë§
- **ì›Œí¬í”Œë¡œìš° ê¸°ë°˜**: JSON ì›Œí¬í”Œë¡œìš° í…œí”Œë¦¿ìœ¼ë¡œ ìœ ì—°í•œ íŒŒì´í”„ë¼ì¸ êµ¬ì„±
- **ì›¹ ëŒ€ì‹œë³´ë“œ**: Vue.js ê¸°ë°˜ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ

---

## ğŸ—ï¸ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Web Dashboard (Vue.js)                   â”‚
â”‚                     static/index.html                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚ HTTP API
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   FastAPI Server (server.py)                â”‚
â”‚  - /api/status: ìƒíƒœ ì¡°íšŒ                                    â”‚
â”‚  - /api/start: ìë™í™” ì‹œì‘                                   â”‚
â”‚  - /api/stop: ìë™í™” ì¤‘ì§€                                    â”‚
â”‚  - /api/assets: ìƒì„±ëœ ì—ì…‹ ëª©ë¡                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                Director Class (automatic.py)                â”‚
â”‚  - _run_image_production(): ì´ë¯¸ì§€ ìƒì„± íŒŒì´í”„ë¼ì¸           â”‚
â”‚  - _generate_image(): ComfyUI API í˜¸ì¶œ                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚ HTTP + WebSocket
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ComfyUI Server (Local: 127.0.0.1:8188)         â”‚
â”‚  - /upload/image: ì´ë¯¸ì§€ ì—…ë¡œë“œ                              â”‚
â”‚  - /prompt: ì›Œí¬í”Œë¡œìš° íì‰                                  â”‚
â”‚  - /ws: ì‹¤ì‹œê°„ ì§„í–‰ë¥  WebSocket                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
automated/
â”œâ”€â”€ automatic.py          # í•µì‹¬ ìë™í™” ë¡œì§ (Director í´ë˜ìŠ¤)
â”œâ”€â”€ comfyui_client.py     # ComfyUI HTTP/WebSocket í´ë¼ì´ì–¸íŠ¸
â”œâ”€â”€ server.py             # FastAPI ì›¹ ì„œë²„
â”œâ”€â”€ cleanup.py            # ì´ë¯¸ì§€ ì •ë¦¬ ìœ í‹¸ë¦¬í‹°
â”œâ”€â”€ requirements.txt      # Python ì˜ì¡´ì„±
â”œâ”€â”€ .env.example          # í™˜ê²½ë³€ìˆ˜ ì˜ˆì‹œ íŒŒì¼
â”œâ”€â”€ workflows/
â”‚   â”œâ”€â”€ __init__.py       # ì›Œí¬í”Œë¡œìš° ëª¨ë“ˆ ì´ˆê¸°í™”
â”‚   â”œâ”€â”€ config.py         # ComfyUI ë…¸ë“œ ID ë§¤í•‘ ì„¤ì •
â”‚   â”œâ”€â”€ workflow_utils.py # ì›Œí¬í”Œë¡œìš° JSON ì¡°ì‘ ìœ í‹¸ë¦¬í‹°
â”‚   â””â”€â”€ image_gen.json    # ì´ë¯¸ì§€ ìƒì„± ì›Œí¬í”Œë¡œìš° í…œí”Œë¦¿
â”œâ”€â”€ assets/
â”‚   â”œâ”€â”€ production_table.csv  # í”„ë¡œë•ì…˜ ì‘ì—… í…Œì´ë¸”
â”‚   â”œâ”€â”€ char_sheet.png        # ìºë¦­í„° ë ˆí¼ëŸ°ìŠ¤ ì‹œíŠ¸
â”‚   â””â”€â”€ images/               # ìƒì„±ëœ ì´ë¯¸ì§€/ë¹„ë””ì˜¤ ì €ì¥ì†Œ
â”œâ”€â”€ static/
â”‚   â””â”€â”€ index.html        # Vue.js ì›¹ ëŒ€ì‹œë³´ë“œ
â”œâ”€â”€ launch_chrome.sh      # Chrome ë””ë²„ê·¸ ëª¨ë“œ ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸ (ë ˆê±°ì‹œ)
â””â”€â”€ start_server.sh       # ì„œë²„ ì‹œì‘ ìŠ¤í¬ë¦½íŠ¸
```

---

## âš™ï¸ í™˜ê²½ë³€ìˆ˜ ì„¤ì •

`.env.example`ì„ `.env`ë¡œ ë³µì‚¬í•˜ê³  í™˜ê²½ì— ë§ê²Œ ìˆ˜ì •í•˜ì„¸ìš”:

```bash
cp .env.example .env
```

### ComfyUI ì„¤ì •

| ë³€ìˆ˜ëª… | ê¸°ë³¸ê°’ | ì„¤ëª… |
|--------|--------|------|
| `COMFYUI_HOST` | `127.0.0.1` | ComfyUI ì„œë²„ í˜¸ìŠ¤íŠ¸ |
| `COMFYUI_PORT` | `8188` | ComfyUI ì„œë²„ í¬íŠ¸ |
| `COMFYUI_USE_SSL` | `false` | SSL ì‚¬ìš© ì—¬ë¶€ |
| `COMFYUI_TIMEOUT` | `600` | ìƒì„± íƒ€ì„ì•„ì›ƒ (ì´ˆ) |

### íŒŒì¼ ê²½ë¡œ ì„¤ì •

| ë³€ìˆ˜ëª… | ê¸°ë³¸ê°’ | ì„¤ëª… |
|--------|--------|------|
| `OUTPUT_DIR` | `./assets/images` | ì¶œë ¥ ë””ë ‰í† ë¦¬ |
| `PRODUCTION_TABLE` | `./assets/production_table.csv` | CSV í…Œì´ë¸” ê²½ë¡œ |
| `CHAR_SHEET_PATH` | `./assets/char_sheet.png` | ìºë¦­í„° ì‹œíŠ¸ ê²½ë¡œ |
| `WORKFLOW_PATH` | `./workflows/image_gen.json` | ì›Œí¬í”Œë¡œìš° JSON ê²½ë¡œ |

### ê¸°íƒ€ ì„¤ì •

| ë³€ìˆ˜ëª… | ê¸°ë³¸ê°’ | ì„¤ëª… |
|--------|--------|------|
| `GENERATION_TIMEOUT` | `600` | ìƒì„± íƒ€ì„ì•„ì›ƒ (ì´ˆ) |
| `MAX_LOG_ENTRIES` | `500` | ìµœëŒ€ ë¡œê·¸ í•­ëª© ìˆ˜ |

---

## ğŸ”§ ì„¤ì¹˜ ë° ì„¤ì •

### 1. ì €ì¥ì†Œ í´ë¡ 

```bash
git clone https://github.com/lovebubbly/AUTOMATED_LOCAL.git
cd AUTOMATED_LOCAL
```

### 2. ê°€ìƒí™˜ê²½ ì„¤ì •

```bash
# ê°€ìƒí™˜ê²½ ìƒì„±
python -m venv venv

# í™œì„±í™” (macOS/Linux)
source venv/bin/activate

# í™œì„±í™” (Windows)
.\venv\Scripts\activate
```

### 3. ì˜ì¡´ì„± ì„¤ì¹˜

```bash
pip install -r requirements.txt
```

### 4. ComfyUI ì„¤ì •

> âš ï¸ **í•„ìˆ˜**: ComfyUIê°€ ë¡œì»¬ì— ì„¤ì¹˜ë˜ì–´ ì‹¤í–‰ ì¤‘ì´ì–´ì•¼ í•©ë‹ˆë‹¤.

1. [ComfyUI](https://github.com/comfyanonymous/ComfyUI) ì„¤ì¹˜
2. í•„ìš”í•œ ì»¤ìŠ¤í…€ ë…¸ë“œ ì„¤ì¹˜ (ì˜ˆ: IP-Adapter, ControlNet ë“±)
3. ComfyUI ì„œë²„ ì‹¤í–‰:
   ```bash
   python main.py --listen 127.0.0.1 --port 8188
   ```

### 5. ì›Œí¬í”Œë¡œìš° ì„¤ì •

1. ComfyUIì—ì„œ ì›í•˜ëŠ” ì›Œí¬í”Œë¡œìš° êµ¬ì„±
2. "Save (API Format)" ë²„íŠ¼ìœ¼ë¡œ JSON ë‚´ë³´ë‚´ê¸°
3. `workflows/image_gen.json`ì— ì €ì¥
4. `workflows/config.py`ì—ì„œ ë…¸ë“œ ID ë§¤í•‘ ì„¤ì •

### 6. í™˜ê²½ë³€ìˆ˜ ì„¤ì •

```bash
cp .env.example .env
# í•„ìš”ì— ë”°ë¼ .env ìˆ˜ì •
```

### 7. ì„œë²„ ì‹¤í–‰

```bash
uvicorn server:app --reload --host 0.0.0.0 --port 8000
```

### 8. ëŒ€ì‹œë³´ë“œ ì ‘ì†

ë¸Œë¼ìš°ì €ì—ì„œ `http://localhost:8000` ì ‘ì†

---

## ğŸ“ Production Table í˜•ì‹

`assets/production_table.csv` íŒŒì¼ì€ ë‹¤ìŒ ì»¬ëŸ¼ì„ í¬í•¨í•©ë‹ˆë‹¤:

| ì»¬ëŸ¼ | ì„¤ëª… |
|------|------|
| `Block` | ë¸”ë¡ ë²ˆí˜¸ (ìˆœì„œ ì‹ë³„ì) |
| `Time` | íƒ€ì„ì½”ë“œ (ì˜ˆ: 1:15-1:20) |
| `Protocol` | ìƒì„± í”„ë¡œí† ì½œ (A: Keyframe, B: Open) |
| `Visual Action` | ì‹œê°ì  ì•¡ì…˜ ì„¤ëª… |
| `Nano Banana (Start Frame)` | ì‹œì‘ í”„ë ˆì„ ìƒì„± í”„ë¡¬í”„íŠ¸ |
| `Nano Banana (End Frame)` | ë í”„ë ˆì„ ìƒì„± í”„ë¡¬í”„íŠ¸ (Protocol Aë§Œ) |
| `Kling O1 (Motion Prompt)` | ë¹„ë””ì˜¤ ëª¨ì…˜ í”„ë¡¬í”„íŠ¸ |

### íŠ¹ìˆ˜ í”Œë ˆì´ìŠ¤í™€ë”

- `[Input: Last Frame]` - ì´ì „ ë¸”ë¡ì˜ ë§ˆì§€ë§‰ í”„ë ˆì„ì„ ì¬ì‚¬ìš©
- `[Loop Bank]` - ë£¨í”„ ë±…í¬ì—ì„œ ì´ë¯¸ì§€ ì„ íƒ
- `(Auto-Generate)` - ìë™ ìƒì„± ëª¨ë“œ

---

## ğŸ® ì‚¬ìš© ë°©ë²•

### ì›¹ ëŒ€ì‹œë³´ë“œ (ê¶Œì¥)

1. ì„œë²„ ì‹¤í–‰ í›„ `http://localhost:8000` ì ‘ì†
2. **Start Block**: ì‹œì‘í•  ë¸”ë¡ ë²ˆí˜¸ ì…ë ¥
3. ì‹¤í–‰ ëª¨ë“œ ì„ íƒ:
   - ğŸ–¼ï¸ **Image Gen**: ì´ë¯¸ì§€ë§Œ ìƒì„±
   - ğŸ¥ **Video Gen**: ë¹„ë””ì˜¤ë§Œ ìƒì„± (ê³„íš ì¤‘)
   - ğŸš€ **Full Pipeline**: ì´ë¯¸ì§€ â†’ ë¹„ë””ì˜¤ ìˆœì°¨ ì‹¤í–‰

### CLI ëª¨ë“œ

```bash
python automatic.py
```

---

## ğŸ› ï¸ í•µì‹¬ ì»´í¬ë„ŒíŠ¸

### ComfyUIClient (`comfyui_client.py`)

```python
class ComfyUIClient:
    """ComfyUI HTTP/WebSocket API í´ë¼ì´ì–¸íŠ¸"""
    
    def upload_image(self, path, subfolder="", overwrite=True)
    def queue_prompt(self, workflow_dict)
    def wait_for_completion(self, prompt_id, timeout=600)
    def download_results(self, prompt_id, output_dir)
```

### Director í´ë˜ìŠ¤ (`automatic.py`)

```python
class Director:
    def __init__(self):
        self.is_running = False      # ì‹¤í–‰ ìƒíƒœ
        self.stop_requested = False  # ì¤‘ì§€ ìš”ì²­ í”Œë˜ê·¸
        self.status = "IDLE"         # í˜„ì¬ ìƒíƒœ
        self.current_block = "-"     # í˜„ì¬ ì²˜ë¦¬ ì¤‘ì¸ ë¸”ë¡
        self.logs = []               # ë¡œê·¸ ë²„í¼
        self.generated_images = []   # ìƒì„±ëœ ì´ë¯¸ì§€ ëª©ë¡
```

### ì›Œí¬í”Œë¡œìš° ìœ í‹¸ë¦¬í‹° (`workflows/workflow_utils.py`)

```python
def load_workflow(path)           # ì›Œí¬í”Œë¡œìš° JSON ë¡œë“œ
def set_positive_prompt(...)      # ê¸ì • í”„ë¡¬í”„íŠ¸ ì„¤ì •
def set_reference_image(...)      # ë ˆí¼ëŸ°ìŠ¤ ì´ë¯¸ì§€ ì„¤ì •
def set_character_sheet(...)      # ìºë¦­í„° ì‹œíŠ¸ ì„¤ì •
def set_output_prefix(...)        # ì¶œë ¥ íŒŒì¼ëª… í”„ë¦¬í”½ìŠ¤ ì„¤ì •
```

---

## ğŸŒ API ì—”ë“œí¬ì¸íŠ¸

| ë©”ì„œë“œ | ì—”ë“œí¬ì¸íŠ¸ | ì„¤ëª… |
|--------|-----------|------|
| GET | `/api/status` | í˜„ì¬ ìƒíƒœ ì¡°íšŒ |
| POST | `/api/start` | ìë™í™” ì‹œì‘ |
| POST | `/api/stop` | ìë™í™” ì¤‘ì§€ |
| GET | `/api/assets` | ìƒì„±ëœ ì—ì…‹ ëª©ë¡ |

---

## ğŸ“Š í˜¸í™˜ì„±

| í”Œë«í¼ | ì§€ì› ìƒíƒœ |
|--------|----------|
| macOS (Intel/Apple Silicon) | âœ… ì™„ì „ ì§€ì› |
| Windows 10/11 | âœ… ì™„ì „ ì§€ì› |
| Linux | âš ï¸ í…ŒìŠ¤íŠ¸ í•„ìš” |

### ê¶Œì¥ í•˜ë“œì›¨ì–´

| êµ¬ì„±ìš”ì†Œ | ìµœì†Œ ì‚¬ì–‘ | ê¶Œì¥ ì‚¬ì–‘ |
|----------|----------|----------|
| GPU | RTX 3060 12GB | RTX 4080 ì´ìƒ |
| RAM | 16GB | 32GB ì´ìƒ |
| VRAM | 12GB | 16GB ì´ìƒ |

---

## ğŸ”„ ë§ˆì´ê·¸ë ˆì´ì…˜ ë…¸íŠ¸ (Playwright â†’ ComfyUI)

ì´ ë²„ì „ì€ ê¸°ì¡´ Playwright ê¸°ë°˜ ì›¹ ìë™í™”ì—ì„œ ë¡œì»¬ ComfyUI APIë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ë˜ì—ˆìŠµë‹ˆë‹¤:

| í•­ëª© | ì´ì „ (Playwright) | í˜„ì¬ (ComfyUI) |
|------|-------------------|----------------|
| ì´ë¯¸ì§€ ìƒì„± | Nano Banana ì›¹ ì„œë¹„ìŠ¤ | ë¡œì»¬ ComfyUI |
| í†µì‹  ë°©ì‹ | CDP (Chrome DevTools) | HTTP + WebSocket |
| ì˜ì¡´ì„± | Chrome ë¸Œë¼ìš°ì € í•„ìš” | ComfyUI ì„œë²„ í•„ìš” |
| ì•ˆì •ì„± | UI ë³€ê²½ì— ì·¨ì•½ | API ê¸°ë°˜ìœ¼ë¡œ ì•ˆì •ì  |
| ì†ë„ | ë„¤íŠ¸ì›Œí¬ ì§€ì—° ìˆìŒ | ë¡œì»¬ ì‹¤í–‰ìœ¼ë¡œ ë¹ ë¦„ |

---

## ğŸ“œ ë¼ì´ì„ ìŠ¤

ì´ í”„ë¡œì íŠ¸ëŠ” ê°œì¸ìš© ìë™í™” ë„êµ¬ì…ë‹ˆë‹¤.
ëª¨ë‘ê°€ ììœ ë¡­ê²Œ ì‚¬ìš©í•´ì£¼ì…¨ìœ¼ë©´ ì¢‹ê² ìŠµë‹ˆë‹¤!!

---

## ğŸ¤ ê¸°ì—¬

ì´ìŠˆ ë° PRì€ ì–¸ì œë“  í™˜ì˜í•©ë‹ˆë‹¤!

---

<div align="center">
  <sub>Built with â¤ï¸ by Yunseong [404]</sub>
</div>
